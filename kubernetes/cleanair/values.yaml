# This is a YAML-formatted file.
# Variables to be passed into the templates.
imageTag: 87c453100490c7991459dc3d07c1b069384059dc

# jobs:
#   - name: satellite
#     image:
#       repository: cleanairdocker.azurecr.io/satellite
#       imagePullPolicy: Always
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     args: ['-n', 30]
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: ukmap
#     image:
#       repository: cleanairdocker.azurecr.io/ukmap
#       imagePullPolicy: Always
#     failedJobsHistoryLimit: 10
#     successfulJobsHistoryLimit: 1
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: streetcanyon
#     image:
#       repository: cleanairdocker.azurecr.io/streetcanyon
#       imagePullPolicy: Always
#     failedJobsHistoryLimit: 10
#     successfulJobsHistoryLimit: 1
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: oshighway
#     image:
#       repository: cleanairdocker.azurecr.io/oshighway
#       imagePullPolicy: Always
#     failedJobsHistoryLimit: 10
#     successfulJobsHistoryLimit: 1
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: scoot-backdate
#     image:
#       repository: cleanairdocker.azurecr.io/scoot
#       imagePullPolicy: Always
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     args: ['-n', 30]
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

# cronjobs:
#   - name: laqn
#     image:
#       repository: cleanairdocker.azurecr.io/laqn
#       imagePullPolicy: Always
#     schedule: "5 * * * *"
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: aqe
#     image:
#       repository: cleanairdocker.azurecr.io/aqe
#       imagePullPolicy: Always
#     schedule: "5 * * * *"
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: scoot
#     image:
#       repository: cleanairdocker.azurecr.io/scoot
#       imagePullPolicy: Always
#     schedule: "5 * * * *"
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

#   - name: satellite
#     image:
#       repository: cleanairdocker.azurecr.io/satellite
#       imagePullPolicy: Always
#     schedule: "30 10 * * *"
#     failedJobsHistoryLimit: 1
#     successfulJobsHistoryLimit: 3
#     concurrencyPolicy: Forbid
#     restartPolicy: OnFailure
#     volumes:
#     - name: secrets
#       secret:
#         secretName: secrets

deployments:
    - name: cleanair-api
      replicas: 2
      image:
        repository: cleanairdocker.azurecr.io/cleanairapi
        imagePullPolicy: Always
      ports:
        containerPort: 80
      restartPolicy: Always
      volumeMounts:
      - name: secrets
        mountPath: "/secrets"
        readOnly: true
      volumes:
      - name: secrets
        secret:
            secretName: secrets

services:
    - name: cleanair-api

tls:
    - host: urbanair.turing.ac.uk
      secretName: secret

ingressRules:
    - host: urbanair.turing.ac.uk
      paths:
        - path: /
          serviceName: cleanair-api
          servicePort: 80
