<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>London test </title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css' rel='stylesheet' />
<link rel="stylesheet" href="./styles.css" >
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<div id='console'>
	<div class='session'>
		<div class='session' id='sliderbar'>
			<h2>Time: <label id='Item'>"2020-01-30T00:00:00"</label></h2>
			<input id='slider' class='row' type='range' min='0' max='47' step='1' value='0' />
		</div>
    </div>
    <div>
        <form name="myForm" action="/action_page" onsubmit="return validateForm()" method="post">
            Instance ID: <input type="text" name="instanceID">
            <input type="submit" value="Submit">
        </form>
    </div>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2hyaXN0eW5ha291IiwiYSI6ImNrYjB5ZXRubjAyODUyc3BqeXlqZGsycTAifQ.7igbLhd8jNwEe6gZZ7oyAw';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v11',
        center: [-0.127872, 51.503890],
        zoom: 13
    });
  
 	map.on('load', function() {
       
	    map.addLayer({
	       	id: 'example_nested',
	        type: 'fill',
            tolerance: 3.5,
	        source: {
	          type: 'geojson',
	          data: './example_nested.geojson' // replace this with the url of your own geojson
	        },
	    	paint: {
	    	    'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get', 'NO2_mean', ['get', "0"]],
                    10,'#FFEDA0',
                    12, '#FED976',
                    14, '#FEB24C',
                    16, '#FD8D3C',
                    18, '#FC4E2A', 
                    20, '#E31A1C',
                    22, '#BD0026', 
                    24, '#800026'
                    ],
	    	    'fill-opacity': 0.7
            }
        
    	});
      
    });

    document.getElementById('slider').addEventListener('input', function(e) {
        var hour = e.target.value;
        console.log(hour)
        var features = map.querySourceFeatures('example_nested', {
        sourceLayer: 'original'
        });          
        var list= features[0].properties[hour];
        var myObj = JSON.parse(list);
        console.log(myObj["measurement_start_utc"])
        document.getElementById('Item').innerText = myObj["measurement_start_utc"];
                
        // update the map
        map.setPaintProperty('example_nested', 'fill-color', [
                    'interpolate',
                    ['linear'],
                    ['get', 'NO2_mean', ['get', hour]],
                    10,'#FFEDA0',
                    12, '#FED976',
                    14, '#FEB24C',
                    16, '#FD8D3C',
                    18, '#FC4E2A', 
                    20, '#E31A1C',
                    22, '#BD0026', 
                    24, '#800026'
                    ]); 
    });

    function validateForm() {
    var x = document.forms["myForm"]["instanceID"].value;
        if (x == "") {
            alert("Instance ID must be filled out");
            return false;
        }
    }
</script>
</body>
</html>
